<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Inventory Management System{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Chart.js Integration for Professional Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Chart.js Plugins for Enhanced Functionality -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1><a href="{{ url_for('index') }}">üì¶ Inventory System</a></h1>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('dashboard') }}" class="{% if request.endpoint == 'dashboard' %}nav-active{% endif %}">Dashboard</a></li>
                <li><a href="{{ url_for('analytics') }}" class="{% if request.endpoint == 'analytics' %}nav-active{% endif %}">Analytics</a></li>
                <li><a href="{{ url_for('products') }}" class="{% if request.endpoint == 'products' %}nav-active{% endif %}">Products</a></li>
                <li><a href="{{ url_for('suppliers') }}" class="{% if request.endpoint == 'suppliers' %}nav-active{% endif %}">Suppliers</a></li>
                <li><a href="{{ url_for('transactions') }}" class="{% if request.endpoint == 'transactions' %}nav-active{% endif %}">Transaction History</a></li>
                <li><a href="{{ url_for('alerts') }}" class="{% if request.endpoint == 'alerts' %}nav-active{% endif %}">Alerts</a></li>
                <li><a href="{{ url_for('reports') }}" class="{% if request.endpoint == 'reports' %}nav-active{% endif %}">Reports</a></li>
                <li><a href="{{ url_for('import_export') }}" class="{% if request.endpoint == 'import_export' %}nav-active{% endif %}">Import/Export</a></li>
                <li><a href="{{ url_for('add_product') }}" class="btn btn-nav-primary">Add Product</a></li>
            </ul>
        </div>
    </nav>
    
    <main class="container">
        <!-- Flash messages for success/error notifications -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </main>

    <!-- Global JavaScript for Chart Management and Enhanced UI -->
    <script>
    // Global chart configuration and utilities
    window.InventoryCharts = {
        // Chart color scheme matching your UI
        colors: {
            primary: '#3498db',
            success: '#27ae60',
            warning: '#f39c12',
            danger: '#e74c3c',
            info: '#9b59b6',
            secondary: '#95a5a6',
            light: '#ecf0f1',
            dark: '#2c3e50'
        },
        
        // Global chart defaults
        defaultOptions: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    labels: {
                        usePointStyle: true,
                        padding: 15,
                        font: {
                            family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(44, 62, 80, 0.95)',
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    cornerRadius: 8,
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 12
                    }
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeInOutQuart'
            }
        },
        
        // Utility functions
        formatCurrency: function(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        },
        
        formatNumber: function(value) {
            return new Intl.NumberFormat('en-US').format(value);
        },
        
        // Chart refresh with loading feedback
        refreshChart: function(chartInstance, buttonElement) {
            if (chartInstance && buttonElement) {
                const originalHTML = buttonElement.innerHTML;
                buttonElement.innerHTML = '‚è≥';
                buttonElement.disabled = true;
                
                chartInstance.update('active');
                
                setTimeout(() => {
                    buttonElement.innerHTML = '‚úÖ';
                    setTimeout(() => {
                        buttonElement.innerHTML = originalHTML;
                        buttonElement.disabled = false;
                    }, 500);
                }, 1000);
            }
        },
        
        // Error handling for chart initialization
        handleChartError: function(error, chartName) {
            console.error(`Error initializing ${chartName} chart:`, error);
            
            // Show user-friendly error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'chart-error';
            errorDiv.innerHTML = `
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-message">
                    <strong>Chart Loading Error</strong><br>
                    Unable to load ${chartName} chart. Please refresh the page.
                </div>
            `;
            
            return errorDiv;
        }
    };

    // Enhanced flash message handling with auto-dismiss
    document.addEventListener('DOMContentLoaded', function() {
        const flashMessages = document.querySelectorAll('.flash');
        
        flashMessages.forEach(function(message) {
            // Auto-dismiss success messages after 5 seconds
            if (message.classList.contains('flash-success')) {
                setTimeout(function() {
                    message.style.opacity = '0';
                    message.style.transform = 'translateY(-10px)';
                    setTimeout(function() {
                        message.remove();
                    }, 300);
                }, 5000);
            }
            
            // Add click-to-dismiss functionality
            message.addEventListener('click', function() {
                this.style.opacity = '0';
                this.style.transform = 'translateY(-10px)';
                setTimeout(() => this.remove(), 300);
            });
        });
        
        // Add loading indicator for page navigation
        const navLinks = document.querySelectorAll('.nav-links a:not(.btn)');
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.href && this.href !== window.location.href) {
                    this.innerHTML += ' ‚è≥';
                }
            });
        });
    });

    // Utility function for API calls with error handling
    window.fetchChartData = async function(endpoint) {
        try {
            const response = await fetch(endpoint);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error('Error fetching chart data:', error);
            return null;
        }
    };
    </script>

    <!-- Custom block for page-specific scripts -->
    {% block scripts %}{% endblock %}
</body>
</html>