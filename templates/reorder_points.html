{% extends "base.html" %}

{% block content %}
<div class="products-container">
    <div class="products-header">
        <h2>Manage Reorder Points</h2>
        <div class="products-summary">
            <span class="product-count">{{ products|length }} products configured</span>
            <a href="{{ url_for('alerts') }}" class="btn btn-primary">View Alerts Dashboard</a>
        </div>
    </div>

    {% if products %}
        <div class="table-container">
            <table class="products-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Current Stock</th>
                        <th>Minimum Threshold</th>
                        <th>Reorder Quantity</th>
                        <th>Status</th>
                        <th>Alert Level</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td class="product-name">
                            <strong>{{ product.name }}</strong>
                            <br><small class="text-muted">{{ product.sku }}</small>
                            {% if product.supplier %}
                                <br><small>{{ product.supplier.name }}</small>
                            {% endif %}
                        </td>
                        <td class="quantity">
                            <span class="quantity-number">{{ product.quantity }}</span>
                        </td>
                        <td class="minimum-threshold">
                            {% if product.reorder_point %}
                                {{ product.reorder_point.minimum_quantity }}
                            {% else %}
                                <span class="text-muted">Not set</span>
                            {% endif %}
                        </td>
                        <td class="reorder-quantity">
                            {% if product.reorder_point %}
                                {{ product.reorder_point.reorder_quantity }}
                            {% else %}
                                <span class="text-muted">Not set</span>
                            {% endif %}
                        </td>
                        <td class="reorder-status">
                            {% if product.reorder_point %}
                                {% if product.reorder_point.is_active %}
                                    <span class="status active">Active</span>
                                {% else %}
                                    <span class="status inactive">Inactive</span>
                                {% endif %}
                            {% else %}
                                <span class="status not-configured">Not Configured</span>
                            {% endif %}
                        </td>
                        <td class="alert-level">
                            {% if product.reorder_point and product.reorder_point.is_active %}
                                {% set alert_level = product.reorder_point.alert_level %}
                                {% if alert_level == 'critical' %}
                                    <span class="alert-badge critical">Critical</span>
                                {% elif alert_level == 'urgent' %}
                                    <span class="alert-badge urgent">Urgent</span>
                                {% elif alert_level == 'warning' %}
                                    <span class="alert-badge warning">Warning</span>
                                {% else %}
                                    <span class="alert-badge ok">Good</span>
                                {% endif %}
                            {% else %}
                                <span class="alert-badge disabled">Disabled</span>
                            {% endif %}
                        </td>
                        <td class="actions">
                            <div class="action-buttons">
                                <a href="{{ url_for('manage_reorder_point', product_id=product.id) }}" 
                                   class="btn btn-small btn-secondary">
                                   {% if product.reorder_point %}Edit{% else %}Setup{% endif %}
                                </a>
                                <a href="{{ url_for('product_history', id=product.id) }}" 
                                   class="btn btn-small btn-secondary">History</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <h3>No Products Found</h3>
            <p>Add some products to your inventory before configuring reorder points.</p>
            <a href="{{ url_for('add_product') }}" class="btn btn-primary">Add Your First Product</a>
        </div>
    {% endif %}
</div>

<style>
.minimum-threshold,
.reorder-quantity {
    text-align: center;
    font-weight: 500;
}

.reorder-status {
    text-align: center;
}

.status {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status.active {
    background-color: #d4edda;
    color: #155724;
}

.status.inactive {
    background-color: #f8d7da;
    color: #721c24;
}

.status.not-configured {
    background-color: #fff3cd;
    color: #856404;
}

.alert-level {
    text-align: center;
}

.alert-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 10px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.alert-badge.critical {
    background-color: #fed7d7;
    color: #c53030;
}

.alert-badge.urgent {
    background-color: #fed7d7;
    color: #e53e3e;
}

.alert-badge.warning {
    background-color: #fefcbf;
    color: #d69e2e;
}

.alert-badge.ok {
    background-color: #f0fff4;
    color: #38a169;
}

.alert-badge.disabled {
    background-color: #e2e8f0;
    color: #718096;
}

@media (max-width: 768px) {
    .products-table th:nth-child(3),
    .products-table td:nth-child(3),
    .products-table th:nth-child(4),
    .products-table td:nth-child(4) {
        display: none;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 0.25rem;
    }
}
</style>
{% endblock %}